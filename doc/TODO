refactor AllMacroExpansionService
    try to move its logic to MacroExpander
    and then try to move MacroExpander logic into some service
    then maybe MacroExpander might be turned into just some dto

add tests
    add test for undef
    add test for infinite recursive macro expansion
        during recursion, macro can be expanded only once

    extend performance test for ExpressionEvaluator
        add optimization if needed
            TODO in ExpressionEvaluator

    for macro package
        for components package
        for services package
        for maro processor

macros
    should we parse directives ?
        create entities for each directive
        create parsers for each directive

    think if expression package is really necessary
        if not then move classes to upper level and delete special exception

    think about MacroConditions and MacroExpander refactoring
        they use the same principle (stateful + validation at the end)
        so they should probably have similar *kind* of implementation

    add possibility to collect macro calls
        maybe as optional parameter to Preprocessor ?

    add support for ## macro joining operation
        it can join tokens of different types
        some combination of token types are invalid
        result should always form a single token
        otherwise warning or error should be thrown
        looks like spaces are ignored as if they didn't exist

    add support for vararg macros
